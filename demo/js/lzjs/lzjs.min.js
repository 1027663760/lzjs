/*
 * lzjs - Compression by LZ algorithm in JavaScript.
 * @version 1.2.0
 * @copyright Copyright (c) 2014 polygon planet <polygon.planet.aqua@gmail.com>
 * @license Licensed under the MIT license.
 */
(function(n,t,k){"undefined"!==typeof exports?"undefined"!==typeof module&&module.exports?module.exports=k():exports[n]=k():"function"===typeof define&&define.amd?define(k):t[n]=k()})("lzjs",this,function(){"use strict";function n(a){this._init(a)}function t(a){this._init(a)}function k(a){this._init(a)}function s(a){this._init(a)}function y(){var a="",b,c,d,e;for(b=0;26>b;b++)for(d="abcdefghijklmnopqrstuvwxyz".charAt(b),c=25;15<c&&1024>a.length;c--)e="abcdefghijklmnopqrstuvwxyz".charAt(c),a+=" "+d+" "+e;for(;1024>
a.length;)a=" "+a;return a=a.slice(0,1024)}function J(a,b){if(a.length===b)return a;if(a.subarray)return a.subarray(0,b);a.length=b;return a}function z(a,b){if(!A)return Array(b);switch(a){case 8:return new Uint8Array(b);case 16:return new Uint16Array(b)}}function v(a){for(var b="",c=0,d=a.length,e;c<d;c++)e=a.charCodeAt(c),128>e?b+=l(e):2048>e?b+=l(192|e>>6&31)+l(128|e&63):65536>e&&(b+=l(224|e>>12&15)+l(128|e>>6&63)+l(128|e&63));return b}function B(a){for(var b="",c=0,d=a.length,e,g,f;c<d;)g=a.charCodeAt(c++),
e=g>>4,0<=e&&7>=e?b+=l(g):12<=e&&13>=e?(e=a.charCodeAt(c++),b+=l((g&31)<<6|e&63)):14===e&&(e=a.charCodeAt(c++),f=a.charCodeAt(c++),b+=l((g&15)<<12|(e&63)<<6|f&63));return b}function C(a,b){for(var c=0,d,e=0,g=a.length;e<g;e++)d=a.charCodeAt(e),128>d?c++:c=2048>d?c+2:c+3;return c}function K(a){var b,c,d,e,g;e=a.length;d=0;for(g="";d<e;){do b=u[a.charCodeAt(d++)&255];while(d<e&&-1===b);if(-1===b)break;do c=u[a.charCodeAt(d++)&255];while(d<e&&-1===c);if(-1===c)break;g+=l(b<<2|(c&48)>>4);do{b=a.charCodeAt(d++)&
255;if(61===b)return g;b=u[b]}while(d<e&&-1===b);if(-1===b)break;g+=l((c&15)<<4|(b&60)>>2);do{c=a.charCodeAt(d++)&255;if(61===c)return g;c=u[c]}while(d<e&&-1===c);if(-1===c)break;g+=l((b&3)<<6|c)}return g}var l=String.fromCharCode,w=Object.prototype.hasOwnProperty,A="undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint16Array,D=!1,E=!1;try{"a"===l.apply(null,[97])&&(D=!0)}catch(N){}if(A)try{"a"===l.apply(null,new Uint8Array([97]))&&(E=!0)}catch(O){}var x=function(){for(var a="",b={8:1,10:1,11:1,
12:1,13:1,92:1},c=0;127>c;c++)w.call(b,c)||(a+=l(c));return a}(),m=x.length,F=Math.max(m,62)-Math.min(m,62),p=m-1,L=65533-m,G=m+1,M=F+20,H=m+5,I=m-F-19;n.prototype={_init:function(a){a||(a={});this._result=this._table=this._data=null;this._onDataCallback=a.onData;this._onEndCallback=a.onEnd;this._maxBytes=a.maxBytes},_createTable:function(){for(var a=z(8,m),b=0;b<m;b++)a[b]=x.charCodeAt(b);return a},_onData:function(a,b){var c;a:{if(D&&E&&65533>b)try{c=l.apply(null,J(a,b));break a}catch(d){}c="";
for(var e=0;e<b;e++)c+=l(a[e])}this._onDataCallback?this._onDataCallback(c):this._result+=c},_onEnd:function(){this._onEndCallback&&this._onEndCallback();this._data=this._table=null},_search:function(){var a=2,b=this._data,c=this._offset,d=p;this._dataLen-c<d&&(d=this._dataLen-c);if(a>d)return!1;var e=c-304,g=b.substring(e,c+d),f=c+a-3-e,h,l,r,k,m;do{if(2===a){if(l=b.charAt(c)+b.charAt(c+1),r=g.indexOf(l),!~r||r>f)break}else l=3===a?l+b.charAt(c+2):b.substr(c,a);k=g.lastIndexOf(l,f);if(!~k)break;
m=k;h=e+k;do if(b.charCodeAt(c+a)!==b.charCodeAt(h+a))break;while(++a<d);if(r===k){a++;break}}while(++a<d);if(2===a)return!1;this._index=304-m;this._length=a-1;return!0},compress:function(a){if(null==a||0===a.length)return"";var b="",b=this._createTable(),c=y(),d=z(8,65533),e=0,g=0;this._result="";this._offset=c.length;this._data=c+a;this._dataLen=this._data.length;var f=-1;a=-1;for(var h;this._offset<this._dataLen;){this._search()?(this._index<p?(c=this._index,f=0):(c=this._index%p,f=(this._index-
c)/p),2===this._length?(d[e++]=b[f+54],d[e++]=b[c],g+=2):(d[e++]=b[f+49],d[e++]=b[c],d[e++]=b[this._length],g+=3),this._offset+=this._length,~a&&(a=-1)):(f=this._data.charCodeAt(this._offset++),132>f?(40>f?(c=f,f=G):(c=f%40,f=(f-c)/40,f+=G),a===f?(d[e++]=b[c],g++):(d[e++]=b[f-M],d[e++]=b[c],g+=2,a=f)):(1640>f?(c=f,f=H):(c=f%1640,f=(f-c)/1640,f+=H),40>c?(h=c,c=0):(h=c%40,c=(c-h)/40),a===f?(d[e++]=b[h],d[e++]=b[c],g+=2):(d[e++]=b[48],d[e++]=b[f-m],d[e++]=b[h],d[e++]=b[c],g+=4,a=f)));if(g>this._maxBytes)return!1;
e>=L&&(this._onData(d,e),e=0)}0<e&&this._onData(d,e);this._onEnd();b=this._result;this._result=null;return null===b?"":b}};t.prototype={_init:function(a){a||(a={});this._result=null;this._onDataCallback=a.onData;this._onEndCallback=a.onEnd},_createTable:function(){for(var a={},b=0;b<m;b++)a[x.charAt(b)]=b;return a},_onData:function(a){this._onDataCallback&&(a?(a=this._result,this._result=null):(a=this._result.substr(1024,64509),this._result=this._result.slice(0,1024)+this._result.substring(65533)),
0<a.length&&this._onDataCallback(a))},_onEnd:function(){this._onEndCallback&&this._onEndCallback()},decompress:function(a){if(null==a||0===a.length)return"";this._result=y();for(var b="",b=this._createTable(),c=!1,d=null,e=a.length,g=0,f,h;g<e;g++)if(f=b[a.charAt(g)],void 0!==f){if(f<I)c?(h=b[a.charAt(++g)],f=40*h+f+1640*d):f=40*d+f,this._result+=l(f);else if(47>f)d=f-I,c=!1;else if(48===f)d=b[a.charAt(++g)],d-=5,c=!0;else if(59>f){d=b[a.charAt(++g)];54>f?(f=(f-49)*p+d,d=b[a.charAt(++g)]):(f=(f-54)*
p+d,d=2);if(h=this._result.slice(-304).slice(-f).substring(0,d)){for(f="";f.length<d;)f+=h;this._result+=f.substring(0,d)}d=null}67581<=this._result.length&&this._onData()}this._result=this._result.substring(1024);this._onData(!0);this._onEnd();b=this._result;this._result=null;return null===b?"":b}};k.prototype={_init:function(a){a||(a={});this._codeStart=a.codeStart||255;this._codeMax=a.codeMax||65535;this._maxBytes=a.maxBytes},compress:function(a){if(null==a||0===a.length)return"";var b="",c=0,
d=0,e=a.length,g="",f=this._codeStart+1,h=this._codeMax,k=2,r=[],m=0,n,p,s,q;for(0<e&&(g=a.charAt(d++));d<e;)if(n=a.charAt(d++),p=g+n,q=p.length,s=1<<q,(32>q&&m&s||32<=q&&void 0!==r[q])&&w.call(r[q],p))g+=n;else{1===g.length?(b+=g,c++):(b+=r[g.length][g],c+=k);if(c>this._maxBytes)return!1;if(f<=h){p=g+n;q=p.length;s=1<<q;if(32>q&&!(m&s)||32<=q&&void 0===r[q])r[q]={},m|=s;r[q][p]=l(f++);2048===f&&(k=3)}g=n}1===g.length?(b+=g,c++):(b+=r[g.length][g],c+=k);return c>this._maxBytes?!1:b},decompress:function(a){if(null==
a||0===a.length)return"";var b="",c={},d=this._codeStart+1,e=this._codeStart,g=0,f=a.length,h,k,m;0<f&&(h=a.charCodeAt(g++),k=l(h),b+=k,m=k);for(;g<f;)h=a.charCodeAt(g++),h=h<=e?l(h):w.call(c,h)?c[h]:m+k,b+=h,k=h.charAt(0),c[d++]=m+k,m=h;return b}};s.prototype={_init:function(a){a||(a={});this._encoding=a.encoding||"utf-8"},compress:function(a){if(null==a||0===a.length)return"";a=""+a;var b="",c=C(a),b=.9*c|0,d=a.length,e={maxBytes:c};if(c===d)d="W",e.codeStart=127,e.codeMax=2047,b=(new k(e)).compress(a),
!1===b&&(d="S",b=(new n(e)).compress(a),!1===b&&(d="N",b=a));else if(c>d&&b<d)d="U",b=(new k(e)).compress(v(a)),!1===b&&(d="S",b=(new n(e)).compress(a),!1===b&&(d="N",b=a));else if(d="S",b=(new n(e)).compress(a),!1===b&&(d="U",b=(new k(e)).compress(v(a)),!1===b||C(b)>c))d="N",b=a;return d+b},decompress:function(a){if(null==a||0===a.length)return"";a=""+a;switch(a.charAt(0)){case "S":return this._decompressByS(a.substring(1));case "W":return this._decompressByW(a.substring(1));case "U":return this._decompressByU(a.substring(1));
case "N":return this._decompressByN(a.substring(1));default:return a}},_decompressByS:function(a){return(new t).decompress(a)},_decompressByW:function(a){return(new k({codeStart:127,codeMax:2047})).decompress(a)},_decompressByU:function(a){return B((new k).decompress(a))},_decompressByN:function(a){return a}};var u=[-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,
-1,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,-1,-1,-1,-1,-1];return{compress:function(a,b){return(new s(b)).compress(a)},decompress:function(a,b){return(new s(b)).decompress(a)},compressToBase64:function(a,b){var c=v((new s(b)).compress(a)),d,e,g,f,h,k;g=c.length;e=0;for(d="";e<g;){f=c.charCodeAt(e++)&255;if(e===g){d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f>>
2)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((f&3)<<4)+"==";break}h=c.charCodeAt(e++);if(e===g){d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f>>2)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((f&3)<<4|(h&240)>>4)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((h&15)<<2)+"=";break}k=c.charCodeAt(e++);d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(f>>
2)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((f&3)<<4|(h&240)>>4)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt((h&15)<<2|(k&192)>>6)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(k&63)}return d},decompressFromBase64:function(a,b){return(new s(b)).decompress(B(K(a)))}}});
